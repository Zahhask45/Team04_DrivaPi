name: Firmware Quality Analysis

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  static-analysis:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Install Cppcheck
        run: |
          sudo apt-get update
          sudo apt-get install -y cppcheck
      
      - name: Run Cppcheck
        run: |
          cppcheck --enable=all \
                   --error-exitcode=1 \
                   --xml \
                   --output-file=cppcheck-report.xml \
                   Core/Src 2>&1 | tee cppcheck-output.txt
      
      - name: Upload Cppcheck Report
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: cppcheck-report
          path: |
            cppcheck-report.xml
            cppcheck-output.txt
          retention-days: 30